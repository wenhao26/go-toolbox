<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Go + SSE ä»·æ ¼æ›´æ–°é€šçŸ¥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f9;
        }

        .price-card {
            background-color: #ffffff;
            padding: 20px 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 50px;
        }

        h1 {
            color: #333;
        }

        #price-display {
            font-size: 3em;
            color: #4CAF50;
            font-weight: bold;
            margin: 20px 0;
        }

        #timestamp {
            font-size: 0.9em;
            color: #777;
        }

        .status {
            margin-top: 15px;
            font-style: italic;
            color: #555;
        }
    </style>
</head>
<body>
<div class="price-card">
    <h1>ğŸš€ BTC/USD å®æ—¶ä»·æ ¼</h1>
    <div id="price-display">$ 0.00</div>
    <div id="timestamp">æœ€åæ›´æ–°æ—¶é—´: æš‚æ— </div>
    <p class="status">çŠ¶æ€: <span id="status-message">æ­£åœ¨è¿æ¥...</span></p>
</div>

<script>
    // 1. åˆ›å»º EventSource å®ä¾‹ï¼Œè¿æ¥åˆ° Go æœåŠ¡å™¨çš„ /events ç«¯ç‚¹
    const eventSource = new EventSource("/events");
    const priceDisplay = document.getElementById("price-display");
    const timestampDisplay = document.getElementById("timestamp");
    const statusMessage = document.getElementById("status-message");

    // 2. ç›‘å¬è¿æ¥æ‰“å¼€äº‹ä»¶
    eventSource.onopen = function (event) {
        console.log("SSE è¿æ¥å·²æ‰“å¼€");
        statusMessage.textContent = "å·²è¿æ¥";
        statusMessage.style.color = 'green';
    };

    // 3. ç›‘å¬æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼ˆonmessage æ˜¯é»˜è®¤äº‹ä»¶å¤„ç†å™¨ï¼‰
    eventSource.onmessage = function (event) {
        console.log("æ”¶åˆ°æ•°æ®:", event.data);

        try {
            // SSE æ•°æ®é€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°†å…¶è§£æä¸º JSON
            const data = JSON.parse(event.data);

            // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
            priceDisplay.textContent = `$ ${parseFloat(data.price).toFixed(2)}`;

            // æ›´æ–°æ—¶é—´æˆ³
            timestampDisplay.textContent = `æœ€åæ›´æ–°æ—¶é—´: ${data.timestamp}`;

        } catch (e) {
            console.error("è§£ææ•°æ®å¤±è´¥:", e, event.data);
        }
    };

    // 4. ç›‘å¬é”™è¯¯äº‹ä»¶
    eventSource.onerror = function (error) {
        console.error("SSE è¿æ¥é”™è¯¯:", error);
        statusMessage.textContent = "è¿æ¥é”™è¯¯ï¼Œæ­£åœ¨å°è¯•é‡è¿...";
        statusMessage.style.color = 'red';
        // æµè§ˆå™¨å†…ç½®çš„ EventSource ä¼šè‡ªåŠ¨å°è¯•é‡è¿
    };

    // 5. ç›‘å¬ç‰¹å®šäº‹ä»¶ï¼ˆå¯é€‰ï¼Œä½†é€šå¸¸ç”¨äºç»“æ„åŒ–æ•°æ®ï¼‰
    // eventSource.addEventListener("custom_event_name", function(event) { ... });

</script>
</body>
</html>